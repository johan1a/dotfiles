#!/usr/bin/env fish
# Set this script as default application to use for magnet links in your browser
set -l magnet_link $argv
set -l sid_path ~/.local/bin/sid.qbittorrent

if not test -f $sid_path
    notify-send "Error: $sid_path does not exist"
    exit 1
end

set sid (cat $sid_path)

http --form POST http://192.168.1.221:30000/api/v2/torrents/add \
  Cookie:SID=$sid \
  urls="$magnet_link" \
  savepath="/downloads" \
  paused:=false

notify-send "Added magnet link
$magnet_link"
