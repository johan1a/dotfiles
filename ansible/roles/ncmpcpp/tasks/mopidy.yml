
  - name: Create directory
    file:
      path: "{{ user_home }}/.config/mopidy/"
      state: directory
      owner: "{{ username }}"

  - name: Link mopidy.conf
    script: >
          scripts/install_dotfile
          "{{ user_home }}/dotfiles/ansible/roles/ncmpcpp/files/mopidy.conf"
          "{{ user_home }}/.config/mopidy/mopidy.conf"

  - command: mkfifo /tmp/mpd.fifo
    failed_when: false

  - file:
      path: "{{ user_home }}/.config/systemd/user/"
      state: directory
      owner: "{{ username }}"

  - file:
      path: "{{ user_home }}/.secrets"
      state: directory
      owner: "{{ username }}"

  - name: Link mopidy startup script
    script: >
          scripts/install_dotfile
          "{{ user_home }}/dotfiles/ansible/roles/ncmpcpp/files/mopidy.fish"
          "{{ user_home }}/.local/bin/mopidy"

  - name: Make mopidy startup script executable
    file:
      src: "{{ user_home }}/dotfiles/ansible/roles/ncmpcpp/files/mopidy.fish"
      dest: "{{ user_home }}/.local/bin/mopidy"
      state: link
      mode: "a+x"
      owner: "{{ username }}"

# - name: Link mopidy.conf
#   file:
#     src:  "{{ user_home }}/dotfiles/ansible/roles/ncmpcpp/files/mopidy.service"
#     dest: "{{ user_home }}/.config/systemd/user/mopidy.service"
#     state: link
#     owner: "{{ username }}"

# - name: Enable mopidy service
#   command: systemctl --user enable mopidy
#   become_user: "{{ username }}"

# - name: Start mopidy service
#   command: sudo systemctl --user start mopidy
#   become_user: "{{ username }}"
#   when: false
